<!DOCTYPE html>
<html lang="es">
    <head>
        <title>♥ Ajax ♥</title>
        <meta charst="UTF-8">
        <meta name="viewport" content="initial-scale=1, width=device-width">
        <!-- <link rel="stylesheet" href="/styles.css"> -->
        <!-- <link rel="icon" type="image/png" href="/img/coffee.png"> -->
    </head>
    <body>
        <h2>Using the XMLHttpRequest object</h2>
        <button type="button" onclick="loadXMLDocGet()">Get</button>
        <button type="button" onclick="loadXMLDocPost()">Post</button>
        <button type="button" onclick="loadXMLDocPost10()">Post x10</button>
        <p id="demoGet"></p>
        <p id="demoPost"></p>
        <p id="demoPost10"></p>
        <script>
            /*
                ♥ Ajax ♥

                Ajax significa Asynchronous JavaScript And XML.
                Tecnologia que inventó Microsoft para realizar comunicación asincrona con nuestra webs.

                Ex:
                    - animals.html --> servdor (MySQL)
                    //   objeto animal <-- JSON

                    // cons animal = getAnimals();
                    for(let i=0; i<animals.length; i++) {

                    }
            // */

            /*
                XMLHttpRequest <-- Objeto que inventó Microsoft.
                1 - Refrescar una parte del DOM.
                http://95.39.145.183/asincrono.php?num=1
                http://95.39.145.183/asincrono2.php
            */
            
            function loadXMLDocGet() {
                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4) {
                        document.getElementById("demoGet").innerHTML = this.responseText;
                        console.log(this.responseText);
                    } else {
                        document.getElementById("demoGet").innerHTML = this.readyState;
                        console.log("El estado es", this.readyState);
                    }
                };
                xhttp.open("GET", "http://95.39.145.183/asincrono.php?num=1", true);
                xhttp.send();
            }
            
            function loadXMLDocPost() {
                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4) {
                        document.getElementById("demoPost").innerHTML = this.responseText;
                        console.log(this.responseText);
                    } else {
                        document.getElementById("demoPost").innerHTML = this.readyState;
                        console.log("El estado es", this.readyState);
                    }
                };
                xhttp.open("POST", "http://95.39.145.183/asincrono2.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send("num=2");
                // CORS ERROR:
                // let jsonData = {
                //     num: "2"
                // };
                // xhttp.setRequestHeader("Content-Type", "application/json");
                // xhttp.send();
            }
            
            function loadXMLDocPost10() {
                for(let i=1; i<=10; i++) {
                    let xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4) {
                            document.getElementById("demoPost10").innerHTML += this.responseText + "<br>";
                            console.log(this.responseText);
                        }
                        // else {
                        //     document.getElementById("demoPost10").innerHTML = this.readyState;
                        //     console.log("El estado es", this.readyState);
                        // }
                    };
                    xhttp.open("POST", "http://95.39.145.183/asincrono2.php", true);
                    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    xhttp.send("num=" + i);
                }
            }

        </script>
    </body>
</html>
